<!DOCTYPE html>
const url = URL.createObjectURL(blob);
const filename = buildFilename({mbgc, sdg, aud, type, title});
return { url, filename };
}


function addFileRow({url, filename}){
emptyState.style.display='none';
const row = document.createElement('div');
row.className='file';
row.innerHTML = `
<div>
<div><strong>${filename}</strong></div>
<div class="muted mono">Ready · ${new Date().toLocaleString()}</div>
</div>
<div class="btns">
<a download="${filename}" href="${url}"><button class="primary">Download</button></a>
<button class="ghost" data-copy>Copy name</button>
</div>
`;
const copyBtn = row.querySelector('[data-copy]');
copyBtn.addEventListener('click', async ()=>{
await navigator.clipboard.writeText(filename);
copyBtn.textContent='Copied!';
setTimeout(()=> copyBtn.textContent='Copy name', 1200);
});
filesDiv.prepend(row);
}


async function runGenerate(){
const mbgc = sanitizeName(document.getElementById('mbgc').value || 'MBGC');
const sdg = sanitizeName(document.getElementById('sdg').value || '9.1');
const aud = sanitizeName(document.getElementById('aud').value || 'C');
const title= sanitizeName(document.getElementById('title').value || 'Virtuous Industry');
const subtitle = document.getElementById('subtitle').value.trim();
const notes = document.getElementById('notes').value.trim();
const types = getSelectedTypes();


if(!types.length){ alert('Select at least one Type (A, Ba, Bb, C).'); return; }


for(const type of types){
const {url, filename} = await generatePDF({mbgc, sdg, aud, type, title, subtitle, notes});
addFileRow({url, filename});
}
}


function validate(){
const mbgc = sanitizeName(document.getElementById('mbgc').value || 'MBGC');
const sdg = sanitizeName(document.getElementById('sdg').value || '9.1');
const aud = sanitizeName(document.getElementById('aud').value || 'C');
const title= sanitizeName(document.getElementById('title').value || 'Virtuous Industry');
const types = getSelectedTypes();
if(!types.length){ alert('No Types selected.'); return; }
const names = types.map(type=> buildFilename({mbgc,sdg,aud,type,title}));
alert('Filenames will be:\n\n' + names.join('\n'));
}


function clearList(){ filesDiv.innerHTML=''; emptyState.style.display='block'; }


document.getElementById('genBtn').addEventListener('click', runGenerate);
document.getElementById('validateBtn').addEventListener('click', validate);
document.getElementById('clearBtn').addEventListener('click', clearList);


// Optional: allow a single token paste (JWT-like) → auto-fill fields
// Example: MBGC_9.1_C_A_Virtuous Industry
window.applyToken = function(token){
const parsed = parseToken(token);
if(!parsed){ alert('Invalid token format. Expected MBGC_9.1_C_A_Title'); return; }
document.getElementById('mbgc').value = parsed.mbgc;
document.getElementById('sdg').value = parsed.sdg;
document.getElementById('aud').value = parsed.aud;
document.getElementById('title').value = parsed.title;
// Set single type selection
$$('#types option').forEach(o=> o.selected = (o.value===parsed.type));
}
</script>
</body>
</html>
